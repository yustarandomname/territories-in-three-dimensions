import{S as P,i as y,s as w,e as D,b as p,v as X,d,f as Z,g as _,h as m,o as $,C as L,D as E,E as F,F as I,k as z,q as J,l as A,m as M,r as K,n as C,G as R,H as x,u as ee,y as B,z as v,A as h,B as U,a as S,c as G}from"../chunks/index.2ecf17a4.js";import{w as te}from"../chunks/index.0449cfc6.js";import{U as re,c as ae}from"../chunks/computeShader3d.ebc538df.js";let T=[],Q;function fe(n,t){T.push({binding:T.entries.length,visibility:GPUShaderStage.COMPUTE,buffer:{type:n}}),Q=t.createBindGroupLayout({label:"bind-group-layout",entries:T})}function ne(){const{subscribe:n,set:t,update:f}=te(void 0);return{subscribe:n,update:r=>f(e=>{if(e!=null)return r(e),e}),addShaderModule:r=>f(e=>{if(e!=null)return e.module=r(e),e}),init:r=>t(r),addBuffer:(r,e,a)=>f(l=>{if(l!=null)return l.buffers.push({label:a,buffer:r}),fe(e,l.device),l}),addResultBuffer:r=>f(e=>(console.log("Do something with result buffer"),e)),reset:()=>t(void 0),getBindGroupLayout:()=>Q}}const b=ne(),le=n=>({adapter:n&2,device:n&4}),q=n=>({adapter:n[1],device:n[2]}),se=n=>({adapter:n&2,device:n&4}),N=n=>({adapter:n[1],device:n[2]}),ue=n=>({error:n&1,adapter:n&2,device:n&4}),Y=n=>({error:n[0],adapter:n[1],device:n[2]});function oe(n){let t;const f=n[6].default,r=L(f,n,n[5],q);return{c(){r&&r.c()},l(e){r&&r.l(e)},m(e,a){r&&r.m(e,a),t=!0},p(e,a){r&&r.p&&(!t||a&38)&&E(r,f,e,e[5],t?I(f,e[5],a,le):F(e[5]),q)},i(e){t||(_(r,e),t=!0)},o(e){d(r,e),t=!1},d(e){r&&r.d(e)}}}function ie(n){let t;const f=n[6].loading,r=L(f,n,n[5],N),e=r||de();return{c(){e&&e.c()},l(a){e&&e.l(a)},m(a,l){e&&e.m(a,l),t=!0},p(a,l){r&&r.p&&(!t||l&38)&&E(r,f,a,a[5],t?I(f,a[5],l,se):F(a[5]),N)},i(a){t||(_(e,a),t=!0)},o(a){d(e,a),t=!1},d(a){e&&e.d(a)}}}function ce(n){let t;const f=n[6].fallback,r=L(f,n,n[5],Y),e=r||_e(n);return{c(){e&&e.c()},l(a){e&&e.l(a)},m(a,l){e&&e.m(a,l),t=!0},p(a,l){r?r.p&&(!t||l&39)&&E(r,f,a,a[5],t?I(f,a[5],l,ue):F(a[5]),Y):e&&e.p&&(!t||l&1)&&e.p(a,t?l:-1)},i(a){t||(_(e,a),t=!0)},o(a){d(e,a),t=!1},d(a){e&&e.d(a)}}}function de(n){let t,f,r;return{c(){t=z("div"),f=z("div"),r=J("Loading..."),this.h()},l(e){t=A(e,"DIV",{class:!0});var a=M(t);f=A(a,"DIV",{class:!0});var l=M(f);r=K(l,"Loading..."),l.forEach(m),a.forEach(m),this.h()},h(){C(f,"class","border w-full max-w-4xl mx-auto p-4 rounded"),C(t,"class","w-full h-full fixed top-0 left-0 z-99 flex justify-center items-center p-12")},m(e,a){p(e,t,a),R(t,f),R(f,r)},p:x,d(e){e&&m(t)}}}function _e(n){let t,f,r;return{c(){t=z("div"),f=z("div"),r=J(n[0]),this.h()},l(e){t=A(e,"DIV",{class:!0});var a=M(t);f=A(a,"DIV",{class:!0});var l=M(f);r=K(l,n[0]),l.forEach(m),a.forEach(m),this.h()},h(){C(f,"class","border w-full max-w-4xl mx-auto p-4 rounded"),C(t,"class","w-full h-full fixed top-0 left-0 z-99 flex justify-center items-center p-12")},m(e,a){p(e,t,a),R(t,f),R(f,r)},p(e,a){a&1&&ee(r,e[0])},d(e){e&&m(t)}}}function me(n){let t,f,r,e;const a=[ce,ie,oe],l=[];function i(u,o){return u[0]?0:!u[1]||!u[2]?1:2}return t=i(n),f=l[t]=a[t](n),{c(){f.c(),r=D()},l(u){f.l(u),r=D()},m(u,o){l[t].m(u,o),p(u,r,o),e=!0},p(u,[o]){let c=t;t=i(u),t===c?l[t].p(u,o):(X(),d(l[c],1,1,()=>{l[c]=null}),Z(),f=l[t],f?f.p(u,o):(f=l[t]=a[t](u),f.c()),_(f,1),f.m(r.parentNode,r))},i(u){e||(_(f),e=!0)},o(u){d(f),e=!1},d(u){l[t].d(u),u&&m(r)}}}function ge(n,t,f){let{$$slots:r={},$$scope:e}=t,{adapterOptions:a=void 0}=t,{deviceDescriptor:l=void 0}=t,i,u,o;return $(async()=>{let c=await navigator.gpu?.requestAdapter(a);if(!c){f(0,i="Need a browser that supports WebGPU this demo only works in Chrome version 114+");return}if(f(1,u=c),f(2,o=await u?.requestDevice(l)),!o){f(0,i="Need a browser that supports WebGPU this demo only works in Chrome version 114+");return}b.init({adapter:u,device:o,buffers:[],pipelines:[]})}),n.$$set=c=>{"adapterOptions"in c&&f(3,a=c.adapterOptions),"deviceDescriptor"in c&&f(4,l=c.deviceDescriptor),"$$scope"in c&&f(5,e=c.$$scope)},[i,u,o,a,l,e,r]}class be extends P{constructor(t){super(),y(this,t,ge,me,w,{adapterOptions:3,deviceDescriptor:4})}}const pe=n=>({}),j=n=>({shaderModule:n[0]});function Be(n){let t;const f=n[4].default,r=L(f,n,n[3],j);return{c(){r&&r.c()},l(e){r&&r.l(e)},m(e,a){r&&r.m(e,a),t=!0},p(e,a){r&&r.p&&(!t||a&8)&&E(r,f,e,e[3],t?I(f,e[3],a,pe):F(e[3]),j)},i(e){t||(_(r,e),t=!0)},o(e){d(r,e),t=!1},d(e){r&&r.d(e)}}}function ve(n){let t,f,r=n[0]&&Be(n);return{c(){r&&r.c(),t=D()},l(e){r&&r.l(e),t=D()},m(e,a){r&&r.m(e,a),p(e,t,a),f=!0},p(e,[a]){e[0]&&r.p(e,a)},i(e){f||(_(r),f=!0)},o(e){d(r),f=!1},d(e){r&&r.d(e),e&&m(t)}}}function he(n,t,f){let{$$slots:r={},$$scope:e}=t,{label:a=void 0}=t,{code:l}=t,i;function u({device:o}){return o.createShaderModule({label:a,code:l})}return $(async()=>{b.addShaderModule(u)}),n.$$set=o=>{"label"in o&&f(1,a=o.label),"code"in o&&f(2,l=o.code),"$$scope"in o&&f(3,e=o.$$scope)},[i,a,l,e,r]}class Ue extends P{constructor(t){super(),y(this,t,he,ve,w,{label:1,code:2})}}function Pe(n,t,f){let{label:r=void 0}=t,{data:e}=t;return $(()=>{function a({device:l}){let i=l.createBuffer({label:r+"state ping",size:e.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_SRC}),u=l.createBuffer({label:r+"state pong",size:e.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});l.queue.writeBuffer(i,0,e),b.addBuffer(i,"read-only-storage"),b.addBuffer(u,"storage")}b.update(a)}),n.$$set=a=>{"label"in a&&f(0,r=a.label),"data"in a&&f(1,e=a.data)},[r,e]}class ye extends P{constructor(t){super(),y(this,t,Pe,null,w,{label:0,data:1})}}function we(n,t,f){let{label:r=void 0}=t,{maxByteSize:e=0}=t;return $(()=>{function a({device:l}){let i=l.createBuffer({label:r,size:e,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});b.addResultBuffer(i)}b.update(a)}),n.$$set=a=>{"label"in a&&f(0,r=a.label),"maxByteSize"in a&&f(1,e=a.maxByteSize)},[r,e]}class ke extends P{constructor(t){super(),y(this,t,we,null,w,{label:0,maxByteSize:1})}}function $e(n,t,f){let{data:r}=t,{label:e=void 0}=t,{error:a=void 0}=t;return $(()=>{let l;if(r instanceof Array)l=new Float32Array(r);else if(r instanceof Float32Array)l=r;else if(r instanceof Object)l=new Float32Array(Object.values(r));else{f(0,a=`Invalid data type for ${e||"uniform buffer"}`);return}function i({device:u}){let o=`Uniform buffer for ${e||"uniform buffer id:"+Math.random()}`,c=u.createBuffer({label:e,size:l.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});u.queue.writeBuffer(c,0,l),b.addBuffer(c,"uniform",o)}b.update(i)}),n.$$set=l=>{"data"in l&&f(1,r=l.data),"label"in l&&f(2,e=l.label),"error"in l&&f(0,a=l.error)},[a,r,e]}class Se extends P{constructor(t){super(),y(this,t,$e,null,w,{data:1,label:2,error:0})}}function Ge(n,t,f){let{label:r=void 0}=t,{data:e}=t;return $(()=>{function a({device:l}){let i=l.createBuffer({label:r+" storage",size:e.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});l.queue.writeBuffer(i,0,e),b.addBuffer(i,"storage")}b.update(a)}),n.$$set=a=>{"label"in a&&f(0,r=a.label),"data"in a&&f(1,e=a.data)},[r,e]}class V extends P{constructor(t){super(),y(this,t,Ge,null,w,{label:0,data:1})}}function Oe(n,t,f){let{entryPoint:r}=t;return n.$$set=e=>{"entryPoint"in e&&f(0,r=e.entryPoint)},[r]}class De extends P{constructor(t){super(),y(this,t,Oe,null,w,{entryPoint:0})}}function H(n){const t=new Float32Array(n[0].length*6);n[3]=t}function ze(n){H(n);let t,f,r,e,a,l,i,u,o,c,k,O;return t=new Se({props:{label:"Hyper params",data:n[1]}}),r=new ye({props:{label:"Cell buffer",data:n[0]}}),a=new V({props:{label:"Agents out red storage",data:n[3]}}),i=new V({props:{label:"Agents out blue storage",data:n[3]}}),o=new ke({props:{label:"Result buffer",maxByteSize:n[0].byteLength}}),k=new De({props:{entryPoint:"update_graffiti_and_push_strength"}}),{c(){B(t.$$.fragment),f=S(),B(r.$$.fragment),e=S(),B(a.$$.fragment),l=S(),B(i.$$.fragment),u=S(),B(o.$$.fragment),c=S(),B(k.$$.fragment)},l(s){v(t.$$.fragment,s),f=G(s),v(r.$$.fragment,s),e=G(s),v(a.$$.fragment,s),l=G(s),v(i.$$.fragment,s),u=G(s),v(o.$$.fragment,s),c=G(s),v(k.$$.fragment,s)},m(s,g){h(t,s,g),p(s,f,g),h(r,s,g),p(s,e,g),h(a,s,g),p(s,l,g),h(i,s,g),p(s,u,g),h(o,s,g),p(s,c,g),h(k,s,g),O=!0},p(s,g){H(s)},i(s){O||(_(t.$$.fragment,s),_(r.$$.fragment,s),_(a.$$.fragment,s),_(i.$$.fragment,s),_(o.$$.fragment,s),_(k.$$.fragment,s),O=!0)},o(s){d(t.$$.fragment,s),d(r.$$.fragment,s),d(a.$$.fragment,s),d(i.$$.fragment,s),d(o.$$.fragment,s),d(k.$$.fragment,s),O=!1},d(s){U(t,s),s&&m(f),U(r,s),s&&m(e),U(a,s),s&&m(l),U(i,s),s&&m(u),U(o,s),s&&m(c),U(k,s)}}}function Ae(n){let t,f;return t=new Ue({props:{label:"Compute",code:ae,$$slots:{default:[ze]},$$scope:{ctx:n}}}),{c(){B(t.$$.fragment)},l(r){v(t.$$.fragment,r)},m(r,e){h(t,r,e),f=!0},p(r,e){const a={};e&16&&(a.$$scope={dirty:e,ctx:r}),t.$set(a)},i(r){f||(_(t.$$.fragment,r),f=!0)},o(r){d(t.$$.fragment,r),f=!1},d(r){U(t,r)}}}function Me(n){let t,f;return t=new be({props:{$$slots:{default:[Ae]},$$scope:{ctx:n}}}),{c(){B(t.$$.fragment)},l(r){v(t.$$.fragment,r)},m(r,e){h(t,r,e),f=!0},p(r,[e]){const a={};e&16&&(a.$$scope={dirty:e,ctx:r}),t.$set(a)},i(r){f||(_(t.$$.fragment,r),f=!0)},o(r){d(t.$$.fragment,r),f=!1},d(r){U(t,r)}}}let W=625e4;function Ce(n){let t=new re(50,W,3);const f=t.to_f32_buffer(),r={lambda:.5,gamma:.5,beta:66667e-10,size:t.size,iterations:0,total_agents:W};return[f,r]}class Fe extends P{constructor(t){super(),y(this,t,Ce,Me,w,{})}}export{Fe as component};
